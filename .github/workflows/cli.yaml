name: Deploy @supabase-kit/cli

on:
    push:
        branches: [cli]

jobs:
    deploy:
        name: Lint, test, build & publish

        runs-on: ubuntu-latest

        steps:
            - name: â‡ï¸ Checkout repo
              uses: actions/checkout@v4

            - name: Set up Bun
              uses: oven-sh/setup-bun@v1
              with:
                  bun-version: latest

            - name: ğŸ“¥ Install dependencies with Bun (with cache)
              run: bun install

            - name: ğŸ” Type-check @supabase-kit/cli
              run: bun run --filter '@supabase-kit/cli' types

            - name: ğŸ› ï¸ Build @supabase-kit/cli
              run: bun run --filter '@supabase-kit/cli' build

            - name: ğŸš€ Publish @supabase-kit/cli to npm
              uses: JS-DevTools/npm-publish@v1
              with:
                  token: ${{ secrets.NPM_TOKEN }}
                  package: apps/cli/package.json
                  access: public